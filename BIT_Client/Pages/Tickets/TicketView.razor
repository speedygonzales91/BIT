@page "/tickets/{Id:int}"

@inject ITicketService TicketService
@inject IJSRuntime JSRuntime

<MudContainer Class="m-2">
    <MudGrid>
        <MudItem xs="8">
            <MudPaper Class="h-100">
                <MudText Typo="Typo.h4">@TicketModel.Title</MudText>
                <MudText Typo="Typo.h6">Leírás:</MudText>
                <MudMarkdown Value="@TicketModel.Description" />
            </MudPaper>
        </MudItem>


        <MudItem xs="4">
            <MudGrid>
                <MudItem xs="12">
                    <MudPaper Class="d-flex align-center justify-center">
                        <MudList Clickable="true">
                            <MudListItem Icon="@Icons.Filled.Edit">
                                Edit
                            </MudListItem>
                        </MudList>
                        <MudList Clickable="true">
                            <MudListItem Icon="@Icons.Filled.FormatListBulleted" Text="Műveletek">
                                <NestedList>
                                    <MudListItem Icon="@Icons.Material.Filled.StarRate">
                                        Star
                                    </MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.Delete">
                                        Delete
                                    </MudListItem>
                                </NestedList>
                            </MudListItem>
                        </MudList>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12">
                    <MudPaper Class="mud-width-full py-8">
                        <MudText Typo="Typo.h6">Ticket részletek:</MudText>
                        <MudText Align="Align.Left"><b>Id:</b> @TicketModel.Id</MudText>
                        <MudText Align="Align.Left"><b>Létrehozva:</b> @TicketModel.CreatedOn</MudText>
                        <MudText Align="Align.Left"><b>Létrehozta:</b> @TicketModel.CreatedBy</MudText>
                        <MudText Align="Align.Left"><b>Legutoljára frissítve:</b> @TicketModel.UpdatedOn</MudText>
                        <MudText Align="Align.Left"><b>Legutoljára frissítette:</b> @TicketModel.UpdatedBy</MudText>
                        <MudText Align="Align.Left"><b>Kommentek száma:</b> 3</MudText>
                    </MudPaper>
                </MudItem>
            </MudGrid>
        </MudItem>
    </MudGrid>

    <MudGrid>
        <MudItem xs="8">
            <MudText Typo="Typo.h6">Kommentek:</MudText>

            <MudCard Outlined="true">
                <MudCardContent>
                    <MudText>Story of the day</MudText>
                    <ContextMenuTrigger MenuId="myMenu">
                    <MudText Typo="Typo.body2" onmouseup="@GetSelectedText">The quick, brown fox jumps over a lazy dog.</MudText>
                    </ContextMenuTrigger>
                </MudCardContent>
            </MudCard>

            <MudCard Outlined="true">
                <MudCardContent>
                    <MudText>Story of the day</MudText>
                    <MudText Typo="Typo.body2">The quick, brown fox jumps over a lazy dog.</MudText>
                </MudCardContent>
            </MudCard>

        </MudItem>
        <MudItem xs="4">
            <MudText Typo="Typo.h6" GutterBottom="true">Icons with text</MudText>
            <MudPaper Width="100%">
                <MudList Clickable=true Dense=true>
                    <MudListItem Text="Commit1" Icon="@Icons.Filled.Bookmark" />
                    <MudListItem Text="Commit2" Icon="@Icons.Filled.Bookmark" IconColor="Color.Primary" />
                    <MudListItem Text="Commit3" Icon="@Icons.Filled.Bookmark" IconColor="Color.Secondary" />
                </MudList>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>


<ContextMenu Id="myMenu">
    <Item OnClick="@OnClick">Item 1</Item>
    <Item OnClick="@OnClick">Item 2</Item>
    <Item OnClick="@OnClick" Enabled="false">Item 3 (disabled)</Item>
    <Seperator />
    <Item>Submenu
        <SubMenu>
            <Item OnClick="@OnClick">Submenu Item 1</Item>
            <Item OnClick="@OnClick">Submenu Item 2</Item>
        </SubMenu>
    </Item>
</ContextMenu>



@code {
    [Parameter]
    public int? Id { get; set; }

    public string SelectedText { get; set; } = string.Empty;

    private TicketDTO TicketModel { get; set; } = new TicketDTO();
    private IEnumerable<TicketDTO> ChildrenTickets { get; set; } = new List<TicketDTO>();

    protected override async Task OnInitializedAsync()
    {
        if (Id != null)
        {
            TicketModel = await TicketService.GetTicket(Id.Value);
            ChildrenTickets = await TicketService.GetChildrenTickets(Id.Value);
        }
    }

    void OnClick(ItemClickEventArgs e)
    {
        var literal = e.Data as string;
        Console.WriteLine($"Kijelölt szöveg: {SelectedText}");
    }

    async Task GetSelectedText()
    {
        SelectedText = await JSRuntime.InvokeAsync<string>("getSelectedText");
    }
}
